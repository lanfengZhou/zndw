function drags(){document.getElementById("toptest").onmousedown=function(e){e=e||window.event,console.log(e.clientX),fnDown(e,"toptest")}}function fnDown(e,t){var a=document.getElementById(t);disX=e.clientX-a.offsetLeft,disY=e.clientY-a.offsetTop,document.onmousemove=function(e){e=e||window.event,fnMove(e,disX,disY,t)},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null}}function fnMove(e,a,n,i){var o=document.getElementById(i);l=e.clientX-a,t=e.clientY-n,winW=800,winH=600,maxW=winW-o.offsetWidth-10,maxH=winH-o.offsetHeight,l<0?l=0:l>maxW&&(l=maxW),t<0?t=0:t>maxH&&(t=maxH),o.style.left=l+"px",o.style.top=t+"px",$("#show").text("x轴坐标："+l+";y轴坐标："+t)}function updateAll(){$.ajax({url:"/locobj/getValue",type:"post",success:function(e){var t,a;canvasObj.ctx.clearRect(0,0,800,600),canvasObj.ctx.lineWidth=5,canvasObj.ctx.fillStyle="#ffffff",canvasObj.ctx.strokeStyle="#ff0000",canvasObj.ctx.beginPath(),canvasObj.ctx.arc(canvasObj.x,canvasObj.y,canvasObj.r,0,2*Math.PI,!0),canvasObj.ctx.shadowBlur=5,canvasObj.ctx.shadowColor="#000000",canvasObj.ctx.closePath(),canvasObj.ctx.fill(),canvasObj.ctx.stroke(),canvasObj.eles=[];for(var n=0;n<e.locobj.length;n++){var i=JSON.parse(e.locobj[n].data);i&&(t=Math.abs(i.x-canvasObj.x),a=Math.abs(i.y-canvasObj.y),Math.sqrt(Math.pow(t,2)+Math.pow(a,2))>=canvasObj.r?(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(i.x,i.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#f00",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(e.locobj[n])):(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(i.x,i.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#1e70ad",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(e.locobj[n])))}}}),clock1=setTimeout(updateAll,2e3)}function $(e){return document.getElementById(e)}function $XMLHttpRequest(e,t,a,n){if(window.XMLHttpRequest)var i=new XMLHttpRequest;else if(window.ActiveXobject)var i=new ActiveXobject("Microft.XMLHttp");i.open(e,t,!0),i.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),i.send(a),i.onreadystatechange=function(){4==i.readyState&&200==i.status&&n(i.responseText)}}var canvasObj={ctx:"",eles:[],isEmptyObject:function(e){for(var t in e)return!1;return!0},init:function(){var e=document.getElementById("mycavans");this.ctx=e.getContext("2d");var t=this;$.get("/locobj/getArc",function(e){var a=JSON.parse(e.result[0].paths);t.ctx.fillStyle="#ffffff",t.ctx.strokeStyle="#ff0000",t.ctx.beginPath(),t.ctx.arc(a.x,a.y,a.r,0,2*Math.PI,!0),t.ctx.closePath(),t.ctx.fill(),t.ctx.stroke()})},x:"",y:"",r:""};canvasObj.init();var flag=!1,TimeFn=null;$("#mycavans").on("click",function(e){clearTimeout(TimeFn),TimeFn=setTimeout(function(){var t,a;document.getElementById("show");e.layerX||0==e.layerX?(t=e.layerX,a=e.layerY):(e.offsetX||0==e.offsetX)&&(t=e.offsetX,a=e.offsetY),canvasObj.x=t,canvasObj.y=a,flag=!0},300)}),$("#mycavans").on("mousemove",function(e){var t;document.getElementById("show");e.layerX||0==e.layerX?(t=e.layerX,e.layerY):(e.offsetX||0==e.offsetX)&&(t=e.offsetX,e.offsetY),flag&&(canvasObj.ctx.clearRect(0,0,800,600),canvasObj.ctx.fillStyle="#ffffff",canvasObj.ctx.strokeStyle="#ff0000",canvasObj.ctx.beginPath(),canvasObj.r=Math.abs(t-canvasObj.x),canvasObj.ctx.arc(canvasObj.x,canvasObj.y,canvasObj.r,0,2*Math.PI,!0),canvasObj.ctx.closePath(),canvasObj.ctx.fill(),canvasObj.ctx.stroke(),$("#show").html("圆心坐标  X:"+canvasObj.x+",Y:"+canvasObj.y+"</br>半径："+canvasObj.r))}),$("#mycavans").on("dblclick",function(e){clearTimeout(TimeFn),flag=!1;document.getElementById("show");e.layerX||0==e.layerX?(e.layerX,e.layerY):(e.offsetX||0==e.offsetX)&&(e.offsetX,e.offsetY);var t='{"x":'+canvasObj.x+',"y":'+canvasObj.y+',"r":'+canvasObj.r+"}";$.post("/locobj/saveArc",{arc:t},function(e){console.log("success")})}),$("#queryObj").click(function(){window.location.href="./locCanvas.html"}),window.onload=drags,$(function(){$("#eletagList").jqGrid({url:"/eletag/query",datatype:"json",colNames:["电子标签号码","电子标签别名","添加时间","编辑"],colModel:[{name:"number",index:"number",width:50,align:"center",editable:!0,editrules:{required:!0},editoptions:{readonly:!0}},{name:"alias",index:"alias",width:50,align:"center",editable:!0},{name:"insertTime",index:"insertTime",width:50,align:"center",editable:!1},{name:"action",index:"act",width:150,align:"center",sortable:!1}],jsonReader:{root:"eletag",records:"total",total:"pages"},rowNum:10,rowList:[10,20,30],pager:"#tagPager",mtype:"post",viewrecords:!0,caption:"电子标签管理",rownumbers:!0,rownumWidth:40,gridComplete:function(){for(var e=$("#eletagList").jqGrid("getDataIDs"),t=0;t<e.length;t++){var a=e[t];edit="<button style='height:30px;width:50px;' class='edit'>修改</button>",del="<button style='height:30px;width:50px;' class='delete'  onclick=\"jQuery('#eletagList').jqGrid('delGridRow','"+a+"',{url:'/eletag/delete',delData:{id:"+a+'},});" >删除</button>',$("#eletagList").jqGrid("setRowData",e[t],{action:edit+del})}$(".edit").click(function(){var e=$(this).closest("tr").prop("id");jQuery("#eletagList").jqGrid("editGridRow",e,{url:"/eletag/edit"})})}}),jQuery("#eletagList").jqGrid("navGrid","#tagPager",{edit:!1,add:!1,del:!1,search:!1}).navButtonAdd("#tagPager",{caption:"添加标签",buttonicon:"ui-icon-add",onClickButton:function(){$("#overlay").show(),$("#formDiv").slideDown("fast")},position:"last"}),jQuery("#eletagList").jqGrid("setGridWidth",$(window).width()-2,!0),jQuery("#eletagList").jqGrid("setGridHeight",$(window).height()-150,!0),$("#cancle").click(function(){$("#formDiv").slideUp("fast"),$("#overlay").hide()}),$("#tagNum").blur(function(){$.post("/eletag/checkTagnum",{number:$(this).val()},function(e){"exist"==e.result?$("#tagNum").closest("div").next().show():$("#tagNum").closest("div").next().hide()})}),$("#add").click(function(){$.ajax({type:"POST",url:"/eletag/"+$(this).prop("id"),datatype:"json",data:$("#eletagForm").serialize(),success:function(e){$("#formDiv").slideUp("fast"),$("#overlay").hide(),$("#eletagList").jqGrid("setGridParam",{url:"/eletag/query"}).trigger("reloadGrid")}})})}),$(function(){$("#gpsList").jqGrid({url:"/gps/query",datatype:"json",colNames:["GPS识别码","GPS识别码别名","添加时间","编辑"],colModel:[{name:"number",index:"number",width:50,align:"center",editable:!0,editrules:{required:!0},editoptions:{readonly:!0}},{name:"alias",index:"alias",width:50,align:"center",editable:!0},{name:"insertTime",index:"insertTime",width:50,align:"center",editable:!1},{name:"action",index:"act",width:150,align:"center",sortable:!1}],jsonReader:{root:"gps",records:"total",total:"pages"},rowNum:10,rowList:[10,20,30],pager:"#tagPager",mtype:"post",viewrecords:!0,caption:"GPS接收器管理",rownumbers:!0,rownumWidth:40,gridComplete:function(){for(var e=$("#gpsList").jqGrid("getDataIDs"),t=0;t<e.length;t++){var a=e[t];edit="<button style='height:30px;width:50px;' class='edit'>修改</button>",del="<button style='height:30px;width:50px;' class='delete'  onclick=\"jQuery('#gpsList').jqGrid('delGridRow','"+a+"',{url:'/gps/delete',delData:{id:"+a+'},});" >删除</button>',$("#gpsList").jqGrid("setRowData",e[t],{action:edit+del})}$(".edit").click(function(){var e=$(this).closest("tr").prop("id");jQuery("#gpsList").jqGrid("editGridRow",e,{url:"/gps/edit"})})}}),jQuery("#gpsList").jqGrid("navGrid","#tagPager",{edit:!1,add:!1,del:!1,search:!1}).navButtonAdd("#tagPager",{caption:"添加GPS",buttonicon:"ui-icon-add",onClickButton:function(){$("#overlay").show(),$("#formDiv").slideDown("fast")},position:"last"}),jQuery("#gpsList").jqGrid("setGridWidth",$(".gpsList").width()-2,!0),jQuery("#gpsList").jqGrid("setGridHeight",$(window).height()-150,!0),$("#cancle").click(function(){$("#formDiv").slideUp("fast"),$("#overlay").hide()}),$("#tagNum").blur(function(){$.post("/gps/checkTagnum",{number:$(this).val()},function(e){"exist"==e.result?$("#tagNum").closest("div").next().show():$("#tagNum").closest("div").next().hide()})}),$("#add").click(function(){$.ajax({type:"POST",url:"/gps/"+$(this).prop("id"),datatype:"json",data:$("#gpsForm").serialize(),success:function(e){$("#formDiv").slideUp("fast"),$("#overlay").hide(),$("#gpsList").jqGrid("setGridParam",{url:"/gps/query"}).trigger("reloadGrid")}})})}),$(function(){$("#gpsobjList").jqGrid({url:"/gpsobj/query",datatype:"json",colNames:["定位对象类型","定位对象别名","是否绑定GPS","绑定GPS识别码","添加时间","编辑"],colModel:[{name:"typeName",index:"typeName",width:50,align:"center",editable:!0,editrules:{required:!0},editoptions:{readonly:!0}},{name:"alias",index:"alias",width:50,align:"center",editable:!0},{name:"state",index:"state",width:50,align:"center",editable:!0,editoptions:{readonly:!0}},{name:"number",index:"number",width:50,align:"center",editable:!0,editoptions:{readonly:!0}},{name:"insertTime",index:"insertTime",width:50,align:"center",editable:!1,editoptions:{readonly:!0}},{name:"action",index:"act",width:100,align:"center",sortable:!1}],jsonReader:{root:"gpsobj",records:"total",total:"pages"},rowNum:10,rowList:[10,20,30],pager:"#objPager",mtype:"post",viewrecords:!0,caption:"定位对象管理",rownumbers:!0,rownumWidth:40,gridComplete:function(){for(var e=$("#gpsobjList").jqGrid("getDataIDs"),t=0;t<e.length;t++){var a=e[t];edit="<button style='height:30px;width:50px;' class='edit'>修改</button>",del="<button style='height:30px;width:50px;' class='delete'  onclick=\"jQuery('#gpsobjList').jqGrid('delGridRow','"+a+"',{url:'/gpsobj/delete',delData:{id:"+a+'},});" >删除</button>',unbind="<button style='height:30px;width:50px;' class='unbind'>解绑</button>",$("#gpsobjList").jqGrid("setRowData",e[t],{action:edit+del+unbind})}$(".edit").click(function(){var e=$(this).closest("tr").prop("id");$("#LeditNumbers").val(e),$("#edit").show(),$("#add").hide(),$("#overlay").show();var t=$("#gpsobjList").jqGrid("getRowData",e);$("#typeNum option").each(function(){$(this).text()==t.typeName&&$(this).prop("selected",!0)}),$("input:text[name='alias']").val(t.alias),$("input:radio[value="+t.state+"]").prop("checked",!0),"true"==t.state?($(".eleNumber").show(),$.get("/gps/getTagnum",function(e){$("#number").empty(),$("#number").append("<option value='1'>"+t.number+"</option>");for(var a=0;a<e.tagnum.length;a++)$("#number").append("<option value="+e.tagnum[a].id+">"+e.tagnum[a].number+"</option>")})):($("#number").empty(),$(".eleNumber").hide()),$("#formDiv").slideDown("fast")}),$(".unbind").click(function(){var e=$(this).closest("tr").prop("id");$.post("/gpsobj/unbind",{id:e},function(e){$("#gpsobjList").jqGrid("setGridParam",{url:"/gpsobj/query"}).trigger("reloadGrid")})})}}),jQuery("#gpsobjList").jqGrid("navGrid","#objPager",{edit:!1,add:!1,del:!1,search:!1}).navButtonAdd("#objPager",{caption:"添加定位对象",buttonicon:"ui-icon-add",onClickButton:function(){$("#overlay").show(),$("#edit").hide(),$("#add").show(),$("input:text").val(""),$("#number").empty(),$("input:radio[value='false']").prop("checked",!0),$(".eleNumber").hide(),$("#formDiv").slideDown("fast")},position:"last"}),jQuery("#gpsobjList").jqGrid("setGridWidth",$(".gpsobjList").width()-2,!0),jQuery("#gpsobjList").jqGrid("setGridHeight",$(window).height()-150,!0),jQuery("#gpsobjList").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!0}),$("#cancle").click(function(){$("#formDiv").slideUp("fast"),$("#overlay").hide()}),$.get("/loctype/query",function(e){for(var t=0;t<e.loctype.length;t++)$("#typeNum").append("<option value="+e.loctype[t].typeNum+">"+e.loctype[t].typeName+"</option>")}),$("#add,#edit").click(function(){var e=$(this).prop("id");$.ajax({type:"POST",url:"/gpsobj/"+e,datatype:"json",data:$("#gpsobjForm").serialize(),success:function(e){$("#formDiv").slideUp("fast"),$("#overlay").hide(),$("#gpsobjList").jqGrid("setGridParam",{url:"/gpsobj/query"}).trigger("reloadGrid")}})}),$("input:radio").click(function(){"true"==$(this).prop("value")?($(".eleNumber").show(),$.get("/gps/getTagnum",function(e){$("#number").empty(),$("#number").append("<option value='1'>请选择需要绑定的GPS识别码</option>");for(var t=0;t<e.tagnum.length;t++)$("#number").append("<option value="+e.tagnum[t].id+">"+e.tagnum[t].number+"</option>")})):($("#number").empty(),$(".eleNumber").hide())})}),$(function(){$(".dropdown-menu a").click(function(){var e=$(this).prop("name");$("#show").prop("src",e)})});var canvasObj={ctx:"",eles:[],x:"",y:"",r:"",isEmptyObject:function(e){for(var t in e)return!1;return!0},init:function(){var e=document.getElementById("mycavans");this.ctx=e.getContext("2d");var t=this;$.get("/locobj/getArc",function(e){var a=JSON.parse(e.result[0].paths);t.x=a.x,t.y=a.y,t.r=a.r,t.ctx.lineWidth=5,t.ctx.fillStyle="#ffffff",t.ctx.strokeStyle="#ff0000",t.ctx.beginPath(),t.ctx.arc(a.x,a.y,a.r,0,2*Math.PI,!0),t.ctx.shadowBlur=5,t.ctx.shadowColor="#000000",t.ctx.closePath(),t.ctx.fill(),t.ctx.stroke()}),$.get("/locobj/getBindObj",function(e){$("#queryOne").append("<option value=0>请选择单个定位对象</option>");for(var t=0;t<e.result.length;t++)$("#queryOne").append("<option value="+e.result[t].id+">"+e.result[t].alias+"</option>")})}};canvasObj.init(),$("#mycavans").on("mousemove",function(e){var t,a,n=(document.getElementById("mycavans"),document.getElementById("show"));document.getElementById("tc");e.layerX||0==e.layerX?(t=e.layerX,a=e.layerY):(e.offsetX||0==e.offsetX)&&(t=e.offsetX,a=e.offsetY);for(var i=0;i<canvasObj.eles.length;i++){var o=JSON.parse(canvasObj.eles[i].data);if(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(o.x,o.y,8,0,2*Math.PI),canvasObj.ctx.isPointInPath(t,a)){document.getElementById("mycavans").style.cursor="pointer",$("#tc").css("left",t+"px"),$("#tc").css("top",a+"px"),$("#tc").html("对象别名："+canvasObj.eles[i].alias+"</br>绑定电子标签号码："+canvasObj.eles[i].number+"</br>x轴坐标："+o.x+"</br>y轴坐标："+o.y),n.innerHTML="对象别名："+canvasObj.eles[i].alias+"</br></br>绑定电子标签号码："+canvasObj.eles[i].number+"</br></br>x轴坐标："+o.x+"</br></br>y轴坐标："+o.y,$("#tc").css("display","block");break}$("#tc").css("display","none")}}),$("#redraw").click(function(){window.location.href="./canvas.html"});var clock1,clock2;$("#queryAll").click(function(){clearTimeout(clock1),clearTimeout(clock2),updateAll(),$("#queryOne").find("option[value=0]").prop("selected",!0)}),$("#queryOne").change(function(){function e(){$.ajax({url:"/locobj/getValue",type:"post",data:{id:t},success:function(e){var t,a;canvasObj.ctx.clearRect(0,0,800,600),canvasObj.ctx.lineWidth=5,canvasObj.ctx.fillStyle="#ffffff",canvasObj.ctx.strokeStyle="#ff0000",canvasObj.ctx.beginPath(),canvasObj.ctx.arc(canvasObj.x,canvasObj.y,canvasObj.r,0,2*Math.PI,!0),canvasObj.ctx.shadowBlur=5,canvasObj.ctx.shadowColor="#000000",canvasObj.ctx.closePath(),canvasObj.ctx.fill(),canvasObj.ctx.stroke(),canvasObj.ele=[];var n=JSON.parse(e.locobj[0].data);n&&(t=Math.abs(n.x-canvasObj.x),a=Math.abs(n.y-canvasObj.y),Math.sqrt(Math.pow(t,2)+Math.pow(a,2))>=canvasObj.r?(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(n.x,n.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#f00",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(e.locobj[0])):(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(n.x,n.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#1e70ad",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(e.locobj[0])))}}),clock2=setTimeout(e,2e3)}var t=$(this).prop("value");0!=t&&(clearTimeout(clock1),clearTimeout(clock2),e())});var bmap={status:!1,map:"",point:"",overlaysCache:[],polOverlay:[],myOverlay:[],drawingManager:"",init:function(){if(!this.status){this.status=!0,this.map=new BMap.Map("map"),this.point=new BMap.Point(116.307852,40.057031);var e=this.map,t=new BMap.MapTypeControl;t.setAnchor(BMAP_ANCHOR_TOP_LEFT),e.addControl(t),e.centerAndZoom(this.point,12),e.enableScrollWheelZoom(),this.myOverlay&&this.loadMyOverlay()}},loadMyOverlay:function(){var e=this.map;$XMLHttpRequest("get","/gpsobj/getPolygon",null,function(t){for(var a=[],n=JSON.parse(t),i=JSON.parse(n.result),o=0;o<i.length;o++)a.push(new BMap.Point(i[o].lng,i[o].lat));bmap.polOverlay=new BMap.Polygon(a),bmap.polOverlay.disableMassClear(),e.addOverlay(bmap.polOverlay)})},addInfoWindow:function(e,t,a,n,i){e.addEventListener("click",function(e){var o={width:100,height:50,title:"<div style='font-size:16px;font-family:Arial;color:#8e8e8e'>定位对象名称："+t+"</div>",enableMessage:!0},s=new BMap.InfoWindow("<div style='font-size:16px;font-family:Arial;color:#8e8e8e'>原始坐标:("+a+","+n+")</div>",o);this.openInfoWindow(s,i)})},transCoor:function(e,t){var a=new BMap.Convertor,n=[];n.push(e),a.translate(n,1,5,function(e){0===e.status&&t(e.points[0])})},shiftCoor:function(e,t){(new BMap.Convertor).translate(e,1,5,function(e){0===e.status&&t(e.points)})}};bmap.init();var isPanelShow=!0,showPanel=$("showPanel");showPanel.addEventListener("click",function(){var e=$("panelWrap");isPanelShow?(isPanelShow=!1,e.style.width="230px",showPanel.style.marginRight="230px",showPanel.innerHTML="隐藏定位对象>",$XMLHttpRequest("GET","/gpsobj/getBindobj",null,function(e){$("selObj").options.length=0,$("queryOne").options.length=0;var t=JSON.parse(e),a=t.result;$("selObj").options.add(new Option("请选择需要查询的定位对象","1")),$("queryOne").options.add(new Option("请选择需要查询的定位对象","1"));for(var n=0;n<a.length;n++)$("selObj").options.add(new Option(a[n].alias,a[n].id)),$("queryOne").options.add(new Option(a[n].alias,a[n].id))})):(isPanelShow=!0,e.style.width="0px",showPanel.style.marginRight="0px",showPanel.innerHTML="选取定位对象<")},!1);var timer1local,timer2local;$("queryAll").addEventListener("click",function(e){function t(){var e=bmap.map;e.clearOverlays(),$XMLHttpRequest("post","/gpsobj/getValue",null,function(t){for(var a=JSON.parse(t),n=0;n<a.result.length;n++){var i=a.result[n].lastValue;if(null!=i){var o=(a.result[n].alias,i.substr(0,i.indexOf(","))),s=i.substr(i.indexOf(",")+1,i.length),r=new BMap.Point(o,s);!function(t){var n=o,i=s;bmap.transCoor(r,function(o){var s=new BMap.Marker(o);if(e.addOverlay(s),1==BMapLib.GeoUtils.isPointInPolygon(o,bmap.polOverlay)){var r=new BMap.Label(a.result[t].alias,{offset:new BMap.Size(20,-10)});s.setLabel(r)}else{var r=new BMap.Label(a.result[t].alias+"已超出围栏外",{offset:new BMap.Size(20,-10)});r.setStyle({backgroundColor:"red",color:"black",fontSize:"12px",height:"20px",lineHeight:"20px",fontFamily:"微软雅黑"}),s.setLabel(r)}bmap.addInfoWindow(s,a.result[t].alias,n,i,o)})}(n)}}}),timer1local=setTimeout(t,5e3)}this.disabled="true",this.style.opacity=.5,$("selObj").options[0].selected=!0,$("queryOne").options[0].selected=!0,clearTimeout(timer2local),t()}),$("queryOne").addEventListener("change",function(e){function t(){var e=bmap.map,n="id="+a.value;e.clearOverlays(),$XMLHttpRequest("post","/gpsobj/getValue",n,function(t){var a=JSON.parse(t),n=a.result[0].lastValue;if(null!=n){var i=n.substr(0,n.indexOf(",")),o=n.substr(n.indexOf(",")+1,n.length),s=new BMap.Point(i,o);new BMap.Marker(s);bmap.transCoor(s,function(t){var n=new BMap.Marker(t);e.addOverlay(n),n.setAnimation(BMAP_ANIMATION_BOUNCE);var s=new BMap.Label(a.result[0].alias,{offset:new BMap.Size(20,-10)});n.setLabel(s),bmap.addInfoWindow(n,a.result[0].alias,i,o,t),1==BMapLib.GeoUtils.isPointInPolygon(t,bmap.polOverlay)||(s=new BMap.Label(a.result[0].alias+"已超出围栏外",{offset:new BMap.Size(20,-10)}),s.setStyle({backgroundColor:"red",color:"black",fontSize:"12px",height:"20px",lineHeight:"20px",fontFamily:"微软雅黑"}),n.setLabel(s))})}}),timer2local=setTimeout(t,5e3)}var a=this;$("queryAll").disabled=!1,$("queryAll").style.opacity=1,$("selObj").options[0].selected=!0,clearTimeout(timer1local),clearTimeout(timer2local),t()},!1),$("selObj").addEventListener("change",function(e){$("queryAll").disabled=!1,$("queryAll").style.opacity=1,$("queryOne").options[0].selected=!0,clearTimeout(timer1local),clearTimeout(timer2local);var t="id="+this.value,a=bmap.map;a.clearOverlays();$XMLHttpRequest("post","/gpsobj/getHisdata",t,function(e){for(var t=JSON.parse(e),n=[],i=[],o=t.result[0].gpsobj_id,s=0,r=t.result.length;s<r;s++){var l=t.result[s].coordinate,c=l.substr(0,l.indexOf(",")),d=l.substr(l.indexOf(",")+1,l.length),u=new BMap.Point(c,d);i.push(t.result[s].insertTime),n.push(u)}bmap.shiftCoor(n,function(e){var t=0;for(e.length;t<e.length;t++){var n=new BMap.Marker(e[t]);a.addOverlay(n);var s;if(1==BMapLib.GeoUtils.isPointInPolygon(e[t],bmap.polOverlay)?(s=new BMap.Label(o+"在围栏内",{offset:new BMap.Size(20,-10)}),n.setLabel(s)):(s=new BMap.Label(o+"在围栏外,"+i[t],{offset:new BMap.Size(20,-10)}),s.setStyle({backgroundColor:"red",color:"black",fontSize:"12px",height:"20px",lineHeight:"20px",fontFamily:"微软雅黑"}),n.setLabel(s),n.setAnimation(BMAP_ANIMATION_BOUNCE)),t>=1){var r=new BMap.Polyline([e[t-1],e[t]],{strokeColor:"red",strokeWeight:6,strokeOpacity:.5});a.addOverlay(r)}}})})},!1),$("redraw").addEventListener("click",function(e){window.location.href="./editMap.html"},!1),$(function(){$("#locobjList").jqGrid({url:"/locobj/query",datatype:"json",colNames:["定位对象类型","定位对象别名","是否绑定电子标签","绑定电子标签号码","添加时间","编辑"],colModel:[{name:"typeName",index:"typeName",width:50,align:"center",editable:!0,editrules:{required:!0},editoptions:{readonly:!0}},{name:"alias",index:"alias",width:50,align:"center",editable:!0},{name:"state",index:"state",width:50,align:"center",editable:!0,editoptions:{readonly:!0}},{name:"number",index:"number",width:50,align:"center",editable:!0,editoptions:{readonly:!0}},{name:"insertTime",index:"insertTime",width:50,align:"center",editable:!1,editoptions:{readonly:!0}},{name:"action",index:"act",width:100,align:"center",sortable:!1}],jsonReader:{root:"locobj",records:"total",total:"pages"},rowNum:10,rowList:[10,20,30],pager:"#objPager",mtype:"post",viewrecords:!0,caption:"定位对象管理",rownumbers:!0,rownumWidth:40,gridComplete:function(){for(var e=$("#locobjList").jqGrid("getDataIDs"),t=0;t<e.length;t++){var a=e[t];edit="<button style='height:30px;width:50px;' class='edit'>修改</button>",del="<button style='height:30px;width:50px;' class='delete'  onclick=\"jQuery('#locobjList').jqGrid('delGridRow','"+a+"',{url:'/locobj/delete',delData:{id:"+a+'},});" >删除</button>',unbind="<button style='height:30px;width:50px;' class='unbind'>解绑</button>",$("#locobjList").jqGrid("setRowData",e[t],{action:edit+del+unbind})}$(".edit").click(function(){var e=$(this).closest("tr").prop("id");$("#LeditNumbers").val(e),$("#edit").show(),$("#add").hide(),$("#overlay").show();var t=$("#locobjList").jqGrid("getRowData",e);$("#typeNum option").each(function(){$(this).text()==t.typeName&&$(this).prop("selected",!0)}),$("input:text[name='alias']").val(t.alias),$("input:radio[value="+t.state+"]").prop("checked",!0),"true"==t.state?($(".eleNumber").show(),$.get("/eletag/getTagnum",function(e){$("#number").empty(),$("#number").append("<option value='1'>"+t.number+"</option>");for(var a=0;a<e.tagnum.length;a++)$("#number").append("<option value="+e.tagnum[a].id+">"+e.tagnum[a].number+"</option>")})):($("#number").empty(),$(".eleNumber").hide()),$("#formDiv").slideDown("fast")}),$(".unbind").click(function(){var e=$(this).closest("tr").prop("id");$.post("/locobj/unbind",{id:e},function(e){$("#locobjList").jqGrid("setGridParam",{url:"/locobj/query"}).trigger("reloadGrid")})})}}),jQuery("#locobjList").jqGrid("navGrid","#objPager",{edit:!1,add:!1,del:!1,search:!1}).navButtonAdd("#objPager",{caption:"添加定位对象",buttonicon:"ui-icon-add",onClickButton:function(){$("#overlay").show(),$("#edit").hide(),$("#add").show(),$("input:text").val(""),$("#number").empty(),$("input:radio[value='false']").prop("checked",!0),$(".eleNumber").hide(),$("#formDiv").slideDown("fast")},position:"last"}),jQuery("#locobjList").jqGrid("setGridWidth",$(".eletagList").width()-2,!0),jQuery("#locobjList").jqGrid("setGridHeight",$(window).height()-150,!0),jQuery("#locobjList").jqGrid("filterToolbar",{stringResult:!0,searchOnEnter:!0}),$("#cancle").click(function(){$("#formDiv").slideUp("fast"),$("#overlay").hide()}),$.get("/loctype/query",function(e){for(var t=0;t<e.loctype.length;t++)$("#typeNum").append("<option value="+e.loctype[t].typeNum+">"+e.loctype[t].typeName+"</option>")}),$("#add,#edit").click(function(){var e=$(this).prop("id");$.ajax({type:"POST",url:"/locobj/"+e,datatype:"json",data:$("#locobjForm").serialize(),success:function(e){$("#formDiv").slideUp("fast"),$("#overlay").hide(),$("#locobjList").jqGrid("setGridParam",{url:"/locobj/query"}).trigger("reloadGrid")}})}),$("input:radio").click(function(){"true"==$(this).prop("value")?($(".eleNumber").show(),$.get("/eletag/getTagnum",function(e){$("#number").empty(),$("#number").append("<option value='1'>请选择需要绑定的电子标签</option>");for(var t=0;t<e.tagnum.length;t++)$("#number").append("<option value="+e.tagnum[t].id+">"+e.tagnum[t].number+"</option>")})):($("#number").empty(),$(".eleNumber").hide())})});var func=function(){var e=1;return function(){e++,alert(e)}},f=func();f(),f(),f();