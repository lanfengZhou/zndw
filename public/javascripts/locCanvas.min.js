function updateAll(){$.ajax({url:"/locobj/getValue",type:"post",success:function(a){var c,t;canvasObj.ctx.clearRect(0,0,800,600),canvasObj.ctx.lineWidth=5,canvasObj.ctx.fillStyle="#ffffff",canvasObj.ctx.strokeStyle="#ff0000",canvasObj.ctx.beginPath(),canvasObj.ctx.arc(canvasObj.x,canvasObj.y,canvasObj.r,0,2*Math.PI,!0),canvasObj.ctx.shadowBlur=5,canvasObj.ctx.shadowColor="#000000",canvasObj.ctx.closePath(),canvasObj.ctx.fill(),canvasObj.ctx.stroke(),canvasObj.eles=[];for(var e=0;e<a.locobj.length;e++){var s=JSON.parse(a.locobj[e].data);s&&(c=Math.abs(s.x-canvasObj.x),t=Math.abs(s.y-canvasObj.y),Math.sqrt(Math.pow(c,2)+Math.pow(t,2))>=canvasObj.r?(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(s.x,s.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#f00",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(a.locobj[e])):(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(s.x,s.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#1e70ad",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(a.locobj[e])))}}}),clock1=setTimeout(updateAll,2e3)}var canvasObj={ctx:"",eles:[],x:"",y:"",r:"",isEmptyObject:function(a){for(var c in a)return!1;return!0},init:function(){var a=document.getElementById("mycavans");this.ctx=a.getContext("2d");var c=this;$.get("/locobj/getArc",function(a){var t=JSON.parse(a.result[0].paths);c.x=t.x,c.y=t.y,c.r=t.r,c.ctx.lineWidth=5,c.ctx.fillStyle="#ffffff",c.ctx.strokeStyle="#ff0000",c.ctx.beginPath(),c.ctx.arc(t.x,t.y,t.r,0,2*Math.PI,!0),c.ctx.shadowBlur=5,c.ctx.shadowColor="#000000",c.ctx.closePath(),c.ctx.fill(),c.ctx.stroke()}),$.get("/locobj/getBindObj",function(a){$("#queryOne").append("<option value=0>请选择单个定位对象</option>");for(var c=0;c<a.result.length;c++)$("#queryOne").append("<option value="+a.result[c].id+">"+a.result[c].alias+"</option>")})}};canvasObj.init(),$("#mycavans").on("mousemove",function(a){var c,t,e=(document.getElementById("mycavans"),document.getElementById("show"));document.getElementById("tc");a.layerX||0==a.layerX?(c=a.layerX,t=a.layerY):(a.offsetX||0==a.offsetX)&&(c=a.offsetX,t=a.offsetY);for(var s=0;s<canvasObj.eles.length;s++){var n=JSON.parse(canvasObj.eles[s].data);if(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(n.x,n.y,8,0,2*Math.PI),canvasObj.ctx.isPointInPath(c,t)){document.getElementById("mycavans").style.cursor="pointer",$("#tc").css("left",c+"px"),$("#tc").css("top",t+"px"),$("#tc").html("对象别名："+canvasObj.eles[s].alias+"</br>绑定电子标签号码："+canvasObj.eles[s].number+"</br>x轴坐标："+n.x+"</br>y轴坐标："+n.y),e.innerHTML="对象别名："+canvasObj.eles[s].alias+"</br></br>绑定电子标签号码："+canvasObj.eles[s].number+"</br></br>x轴坐标："+n.x+"</br></br>y轴坐标："+n.y,$("#tc").css("display","block");break}$("#tc").css("display","none")}}),$("#redraw").click(function(){window.location.href="./canvas.html"});var clock1,clock2;$("#queryAll").click(function(){clearTimeout(clock1),clearTimeout(clock2),updateAll(),$("#queryOne").find("option[value=0]").prop("selected",!0)}),$("#queryOne").change(function(){function a(){$.ajax({url:"/locobj/getValue",type:"post",data:{id:c},success:function(a){var c,t;canvasObj.ctx.clearRect(0,0,800,600),canvasObj.ctx.lineWidth=5,canvasObj.ctx.fillStyle="#ffffff",canvasObj.ctx.strokeStyle="#ff0000",canvasObj.ctx.beginPath(),canvasObj.ctx.arc(canvasObj.x,canvasObj.y,canvasObj.r,0,2*Math.PI,!0),canvasObj.ctx.shadowBlur=5,canvasObj.ctx.shadowColor="#000000",canvasObj.ctx.closePath(),canvasObj.ctx.fill(),canvasObj.ctx.stroke(),canvasObj.ele=[];var e=JSON.parse(a.locobj[0].data);e&&(c=Math.abs(e.x-canvasObj.x),t=Math.abs(e.y-canvasObj.y),Math.sqrt(Math.pow(c,2)+Math.pow(t,2))>=canvasObj.r?(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(e.x,e.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#f00",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(a.locobj[0])):(canvasObj.ctx.beginPath(),canvasObj.ctx.arc(e.x,e.y,8,0,2*Math.PI),canvasObj.ctx.fillStyle="#1e70ad",canvasObj.ctx.fill(),canvasObj.ctx.closePath(),canvasObj.eles.push(a.locobj[0])))}}),clock2=setTimeout(a,2e3)}var c=$(this).prop("value");0!=c&&(clearTimeout(clock1),clearTimeout(clock2),a())});